{% extends "base.html" %}

{% block title %}Карта кортов{% endblock %}
{% block header_title %}Карта{% endblock %}

{% block content %}
<div class="map-container">
    <div class="map-wrapper">
        <iframe 
            src="https://yandex.ru/map-widget/v1/?um=constructor%3A364c361b98ec98810672f3b77dfe80b8487de7eac5cd0f7d7b694e1b883f34e4&amp;source=constructor"
            class="yandex-iframe"
            frameborder="0"
            allowfullscreen
            aria-label="Интерактивная карта теннисных кортов">
        </iframe>
        
        <!-- Слой для обработки кликов -->
        <div class="map-overlay" id="map-overlay"></div>
    </div>

    <div class="map-controls">
        <button class="tg-button" onclick="findNearbyCourts()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
            </svg>
            Рядом со мной
        </button>
    </div>
</div>

<script>
// Обработка кликов по карте
document.getElementById('map-overlay').addEventListener('click', (e) => {
    const rect = e.target.getBoundingClientRect();
    const x = (e.clientX - rect.left) / rect.width * 100;
    const y = (e.clientY - rect.top) / rect.height * 100;
    
    console.log(`Clicked at: ${x.toFixed(1)}%, ${y.toFixed(1)}%`);
    
    // Здесь можно определить корт по координатам
    if (x > 40 && x < 60 && y > 30 && y < 50) {
        selectCourt('central_court');
    }
});

function selectCourt(courtId) {
    if (window.Telegram?.WebApp) {
        Telegram.WebApp.showAlert(`Выбран корт ${courtId}`);
    } else {
        alert(`Корт ${courtId} выбран`);
    }
}

function findNearbyCourts() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            position => {
                const { latitude, longitude } = position.coords;
                // Обновляем iframe с новыми координатами
                document.querySelector('.yandex-iframe').src = 
                    `https://yandex.ru/map-widget/v1/?um=constructor%3A364c361b98ec98810672f3b77dfe80b8487de7eac5cd0f7d7b694e1b883f34e4&ll=${longitude},${latitude}&z=15&source=constructor`;
            },
            error => {
                console.error("Geolocation error:", error);
            }
        );
    }
}
</script>
{% endblock %}
