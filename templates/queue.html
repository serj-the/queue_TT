{% extends "base.html" %}

{% block title %}Мои очереди{% endblock %}

{% block content %}
<div class="queue-container">
    <h2>Текущие очереди</h2>
    
    {% for court_id, queue in queues.items() %}
    <div class="court-queue">
        <h3>Корт {{ loop.index }}</h3>
        
        <div class="queue-list">
            {% for player in queue %}
            <div class="queue-item {% if player.user_id == current_user_id %}my-position{% endif %}">
                <span class="position">{{ loop.index }}.</span>
                <span class="name">{{ player.name }}</span>
                <span class="rating">⭐ {{ player.rating }}</span>
            </div>
            {% endfor %}
        </div>
        
        <button class="tg-button join-btn" data-court="{{ court_id }}">
            Встать в очередь
        </button>
    </div>
    {% endfor %}
</div>

<script>
document.querySelectorAll('.join-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
        const courtId = btn.dataset.court;
        
        try {
            const response = await fetch('/api/queue', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    court_id: courtId,
                    user_id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 123,
                    user_name: window.Telegram?.WebApp?.initDataUnsafe?.user?.first_name || "Тест",
                    rating: 1000
                })
            });
            
            const result = await response.json();
            alert(`Вы в очереди! Ваша позиция: ${result.position}`);
            location.reload();
        } catch (error) {
            console.error('Ошибка:', error);
        }
    });
});
</script>
{% endblock %}
